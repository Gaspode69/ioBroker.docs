---
title: Запустите восстановление ioBroker
lastChanged: 03.12.2019
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translatedFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/tutorial/restore.md
hash: 9SyQw5gWCDpvFS0ksEa7NULgmuancyWYV7tkASkVhpg=
---
# Основы
Как правильно восстановить установку ioBroker в системе Linux?

### Предисловие:
Так как некоторым пользователям очень трудно восстанавливать, вот пошаговые инструкции по восстановлению после сбоя или после замены оборудования, изменения системы и т.д.

В принципе, заранее можно сказать одно: восстановление делается за несколько минут, если все сделано правильно, и его не нужно бояться.

В конце все данные снова доступны, и новая система настроена.

### Подготовка:
Для подготовки абсолютно необходима работающая установка ioBroker.

Есть 2 способа добиться этого.
Либо возьмите готовый образ из [область загрузки](https://www.iobroker.net/#de/download), установите собственную ОС Linux и установите ioBroker после этого [инструкции](https://www.iobroker.net/#de/documentation/install/linux.md).

### Следующий шаг
Если старая система хранила состояния и/или объекты в Redis, новая система должна быть сначала оснащена сервером Redis.

Если вы не уверены, использовался ли Redis, и у вас все еще есть доступ к старой системе, используйте команду `iobroker status` для вызова необходимой информации». При использовании Redis вывод выглядит следующим образом:

```
iobroker is running on this host.

At least one iobroker host is running.

Objects type: redis
States  type: redis
```

Если для типа объектов и/или состояний указано «redis», необходимо установить сервер Redis в новой системе.
Если для обоих типов указано «файл», сервер Redis не требуется.

Если у вас больше нет доступа к старой системе и вы не знаете точно, что было настроено ранее, то обязательно заранее установите сервер Redis.

#### Redis установлен:
Перейдите в терминал с Putty и выполните следующие команды:

```
sudo apt-get update
sudo apt-get install redis-server
sudo usermod -a -G redis iobroker
sudo reboot now
```

Далее следует запустить Installer Fix, если все права в системе куда-то не подходят.
Этот шаг является лишь рекомендацией и не является обязательным.

```
curl -sL https://iobroker.net/fix.sh | bash –
```

С помощью небольшого инструмента «htop» вы можете очень хорошо видеть все запущенные процессы, что не только интересно для восстановления, но и может быть очень полезным в целом.
это устанавливается следующим образом:

Выполните следующую команду в консоли:

```
sudo apt-get install htop
```

После того, как это будет сделано, можно приступить к фактическому восстановлению.

### Восстановить:
Тут тоже 2 варианта:

#### **1. Автоматическое восстановление с резервным копированием**
Поскольку здесь не требуется никаких знаний Linux, а все делается через веб-интерфейс Iobroker, вариант автоматического восстановления выполняется сначала с помощью [резервный](https://github.com/simatec/ioBroker.backitup/blob/master/README.md).

Для этого необходимо установить резервную копию адаптера.
Делается это через вкладку «Адаптер». Найдите там Backitup и установите экземпляр с помощью (+).

После завершения установки вы сохраняете свою «резервную копию ioBroker», ранее созданную из старой системы, в новой системе с помощью программы sftp, такой как FileZilla или WinSCP, по пути /opt/iobroker/backups.

Backitup также может выполнять восстановление из NAS, Dropbox или Google Drive, но локальный вариант имеет наименьший потенциал для возникновения проблем.

Если у вас уже есть опыт монтирования с NAS, это тоже можно использовать, тем более, что вы сможете получить прямой доступ к существующему каталогу старой установки.
Однако это руководство относится к локально сохраненной резервной копии.

Если резервная копия ioBroker была успешно сохранена, теперь откроется Backitup и откроется вкладка «Восстановление».
Установите «Источник резервного копирования» на локальный, а затем сохраните.

![вкладка восстановления](../../de/tutorial/media/restore/1575301096581-restoretab.jpg)

Если ВСЕ экземпляры должны запускаться автоматически после восстановления, необходимо активировать и затем сохранить параметр «Запускать все адаптеры после восстановления».
Если резервная копия должна быть восстановлена на другом хосте, эту опцию не следует использовать, так как может потребоваться настроить IP-адреса перед запуском отдельных экземпляров.

После сохранения существующие резервные копии можно вызвать по локальному пути с помощью кнопки «Получить резервные копии».

Резервная копия, которую вы только что загрузили по FTP, должна появиться в списке под iobroker.
Теперь выберите это.

![Выбор резервной копии](../../de/tutorial/media/restore/1575301146928-restoreliste.jpg)

После выбора есть примечание, что iobroker будет остановлен для восстановления, а затем перезапущен.

![Начать восстановление](../../de/tutorial/media/restore/1575301175231-restorestart.jpg)

Здесь вы начали фактический процесс восстановления.

![Восстановить работу](../../de/tutorial/media/restore/1575301208033-restore.jpg)

В вашем браузере откроется еще одна вкладка, где вы сможете следить за процессом восстановления, как на консоли в веб-интерфейсе Backitup.

![восстановитьWebUI.JPG](../../de/tutorial/media/restore/restoreWebUI.JPG)

После успешного завершения восстановления вы также получите сообщение в веб-интерфейсе восстановления.

![восстановитьWebUI_finish.JPG](../../de/tutorial/media/restore/restoreWebUI_finish.JPG)

В зависимости от производительности системы и размера старой установки ioBroker восстановление может занять некоторое время.
Обычно восстановление должно быть завершено примерно через 10-15 минут, и ioBroker должен снова запуститься автоматически.

![Восстановление выполнено](../../de/tutorial/media/restore/1575301228008-restorefinish.jpg)

В очень редких случаях бывает, что ioBroker не запускается автоматически после восстановления.
В этом случае вы можете запустить iobroker вручную с помощью следующей команды через консоль.

```
iobroker start
```

Теперь ioBroker должен запуститься снова и во вкладке «Журнал» вы увидите, что все адаптеры, которые были установлены на старой системе, сейчас переустанавливаются npm.

Здесь нужно проявить немного терпения и просто позволить iobroker сделать это.
В инстансах видно, какие адаптеры установлены один за другим.
Все адаптеры, которые все еще устанавливаются или находятся в очереди, еще не имеют значка в экземплярах.
Пожалуйста, не перезапускайте ioBroker, самое большее время от времени обновляйте вид с помощью F5, пока все экземпляры не будут снабжены значком.

В зависимости от размера установки и скорости вашего компьютера и интернет-соединения, это может легко занять 2-3 часа.

Поздравляем, теперь только что установленная система укомплектована всеми настройками, скриптами, визуализациями и т.д.

Благодаря Backitup теперь есть возможность восстановить дополнительные данные, если они ранее были зарезервированы в старой системе.
Вы можете восстановить базу данных Redis, базу данных Zigbee, базу данных mySql и данные истории, выполнив те же действия, что и выше.

Список извлеченных резервных копий будет выглядеть, как в этом примере.

![полный список](../../de/tutorial/media/restore/1575362131512-fullliste.jpg)

*****************************************************************************************************************************************

#### **2. ручное восстановление с помощью команд терминала**
Во-первых, необходимо выполнить несколько команд с помощью Putty или чего-то подобного.

Во-первых, необходимо создать резервную папку:

```
sudo mkdir /opt/iobroker/backups
```

Тут тоже бэкап созданный на старой системе и при необходимости Redis Backup, zigbee backup и т.д.
поместить в папку /opt/iobroker/backups.

Если состояния и объекты были сохранены в базе данных Redis, сохраненная база данных Redis должна быть сначала восстановлена здесь.
Если под Redis работают только штаты, это не обязательно должно быть сделано заранее.

Как только это будет сделано, остановите ваш ioBroker следующим образом:

```
iobroker stop
```

Затем проверьте, все ли остановлено, с помощью следующих команд:

```
iobroker status
```

Если все выходные данные верны и iobroker был остановлен, восстановление теперь можно выполнить через консоль с помощью следующих команд:

```
cd /opt/iobroker
iobroker restore <Dateiname eures Backups>
```

!> **Очень важно, что этим методом можно восстановить только резервную копию ioBroker.
Резервная копия Redis, резервная копия Zigbee, резервная копия mySql или данные истории не могут быть созданы с помощью этой команды**.

Для этого требуется Backitup, так как они были специально созданы с помощью Backitup.

В зависимости от системы это может занять несколько минут. Прогресс отображается в терминале.
Когда восстановление будет завершено, снова запустите ioBroker с помощью следующей команды:

```
iobroker start
```

Опять же, все адаптеры теперь индивидуально переустанавливаются ioBroker через npm.
Это может занять некоторое время в зависимости от размера вашей установки, скорости интернета и производительности системы.
За текущим статусом можно следить во вкладке «Журнал».

Теперь это сделано, и система переустановлена, и все настройки, скрипты, визуализации и т. Д. Восстановлены.

### Вывод:
В принципе, оба варианта приводят к одному и тому же результату.
Если у вас мало опыта работы с командами терминала и вы чувствуете себя неуверенно, вы в безопасности с Backitup.

Однако, если вы хотите точно увидеть, что происходит в вашей системе, вам следует выбрать ручную версию через консоль. Здесь вы можете подробно увидеть каждый отдельный процесс в терминале.
